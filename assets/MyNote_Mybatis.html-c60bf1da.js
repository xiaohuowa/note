import{_ as n,o as s,c as a,e as t}from"./app-55752f72.js";const e={},p=t(`<h3 id="mybatis里的动态代理" tabindex="-1"><a class="header-anchor" href="#mybatis里的动态代理" aria-hidden="true">#</a> mybatis里的动态代理</h3><h4 id="不用动态代理的话" tabindex="-1"><a class="header-anchor" href="#不用动态代理的话" aria-hidden="true">#</a> 不用动态代理的话</h4><blockquote><p>没用动态代理之前需要手动给出DAO接口的实现类（以下为实现类）</p><p>根据<code>namespace</code>和对应sql的<code>id</code>操作sqlsession执行对应xml里的方法</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取SqlSession对象</span>
        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MyBatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sqlId<span class="token operator">=</span><span class="token string">&quot;com.xiaohuowa.dao.StudentDao.selectStudents&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql语句， 使用SqlSession类的方法</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students  <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>sqlId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭</span>
        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> students<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="用动态代理" tabindex="-1"><a class="header-anchor" href="#用动态代理" aria-hidden="true">#</a> 用动态代理</h4><blockquote><p>因为DAO接口的全限定名就是<code>namespace</code>的名字（自己命名要规范）</p><p>且DAO里的方法名就对应了sql的<code>id</code>（自己命名要规范）</p><p>所以可以通过动态代理机制来简化操作</p><p>mybatis的动态代理： mybatis根据 dao的方法调用，获取执行sql语句的信息</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Student</span><span class="token punctuation">&gt;</span></span> studentList  = dao.selectStudents(); 调用
 * 1.dao对象，类型是StudentDao，全限定名称是：com.xiaohuowa.dao.StudentDao
 *   全限定名称 和 namespace 是一样的。
 *
 * 2.方法名称， selectStudents， 这个方法就是 mapper文件中的 id值 selectStudents
 *
 * 3.通过dao中方法的返回值也可以确定MyBatis要调用的SqlSession的方法
 *    如果返回值是List ，调用的是SqlSession.selectList()方法。
 *    如果返回值 int ，或是非List的， 看mapper文件中的 标签是<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span><span class="token punctuation">&gt;</span></span>，<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span><span class="token punctuation">&gt;</span></span> 就会调用
 *    SqlSession的insert， update等方法
 *
 *  mybatis的动态代理： mybatis根据 dao的方法调用，获取执行sql语句的信息。
 *     mybatis根据你的dao接口，创建出一个dao接口的实现类， 并创建这个类的对象。
 *     完成SqlSession调用方法， 访问数据库。
 *
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过<code>sqlSession.getMapper(DAO接口.class)</code>来获取一个Mapper接口的代理对象</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 使用mybatis的动态代理机制， 使用SqlSession.getMapper(dao接口)
     * getMapper能获取dao接口对于的实现类对象。
     */</span>
    <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MyBatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StudentDao</span> dao  <span class="token operator">=</span>  sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//com.sun.proxy.$Proxy2 : jdk的动态代理</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;dao=&quot;</span><span class="token operator">+</span>dao<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//调用dao的方法， 执行数据库的操作</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">selectStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token operator">:</span> students<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;学生=&quot;</span><span class="token operator">+</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql入参" tabindex="-1"><a class="header-anchor" href="#sql入参" aria-hidden="true">#</a> SQL入参</h3><h4 id="参数是个对象" tabindex="-1"><a class="header-anchor" href="#参数是个对象" aria-hidden="true">#</a> ⭐参数是个对象</h4><p>复杂的语法：</p><p><code>#{属性名,javaType=类型名称,jdbcType=数据类型} </code></p><ol><li><p>javaType:指java中的属性数据类型。</p></li><li><p>jdbcType:在数据库中的数据类型。</p></li></ol><p>例如： <code>#{paramName,javaType=java.lang.String,jdbcType=VARCHAR}</code></p><p>简化的语法：</p><p><code># {属性名} </code></p><p>javaType, jdbcType的值mybatis反射能获取。不用提供</p><h4 id="参数有多个" tabindex="-1"><a class="header-anchor" href="#参数有多个" aria-hidden="true">#</a> ⭐参数有多个</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 多个参数： 命名参数，在形参定义的前面加入 @Param(&quot;自定义参数名称&quot;)
 */</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectMultiParam</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                               <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在xml里直接用<code>#{名字}</code>就行</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--多个参数，使用@Param命名--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectMultiParam<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaohuowa.domain.Student<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     select id,name, email,age from student where name=#{p1} or age=#{p2}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="按位置-不常用" tabindex="-1"><a class="header-anchor" href="#按位置-不常用" aria-hidden="true">#</a> 按位置（不常用）</h5><p>多个参数-简单类型的，按位置传值，</p><ul><li><strong>mybatis 3.4</strong>之前，使用 <code>#{0} ，#{1}</code></li><li><strong>mybatis 3.4</strong>及之后 ，使用<code> #{arg0} ,#{arg1}</code></li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--多个参数使用位置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectMultiPosition<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaohuowa.domain.Student<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      select id,name, email,age from student where
      name = #{arg0} or age=#{arg1}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="入参是map" tabindex="-1"><a class="header-anchor" href="#入参是map" aria-hidden="true">#</a> ⭐⭐入参是Map</h4><blockquote><p>如果参数有多个的话，封装成map集合更有语义，查询条件更明确</p><p>在SQL语句中占位的写法<code>#{map的key}</code></p></blockquote><p>查询出生日期在范围内的所有数据</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetByMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Date</span> begin <span class="token operator">=</span> sf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;1999-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Date</span> end <span class="token operator">=</span> sf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;1999-12-31&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;birthdayBegin&quot;</span><span class="token punctuation">,</span>begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;birthdayEnd&quot;</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> uMapper<span class="token punctuation">.</span><span class="token function">getByMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>users <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getByMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>users<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    select <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>allColumns<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
    from users
    where birthday between #{birthdayBegin} and #{birthdayEnd}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="和" tabindex="-1"><a class="header-anchor" href="#和" aria-hidden="true">#</a> #{}和\${}</h3><blockquote><p>如果parameterType的类型是<strong>简单类型</strong>(8种基本(封装)+String),则<code>#{}/\${}</code>里随便写写啥都行</p><p>如果是实体类的类型,则只能是类中成员<strong>变量的名称</strong>,而且区分大小写</p></blockquote><ol><li><p>使用 #{}</p><ul><li><code>select * from student where id=#{studentId}</code><ul><li>#{} 的结果： select* from student where <strong>id=?</strong></li></ul></li></ul></li><li><p>使用 \${}</p><ul><li><p><code>select id,name, email,age from student where id=\${studentId}</code></p><ul><li><p>\${} 的结果：select * student where <strong>id=1001</strong></p></li><li><p>相当于是：String sql=&quot;select * from student where id=&quot; + &quot;1001&quot;;</p></li><li><p>使用的Statement对象执行sql， 效率比PreparedStatement低。</p></li></ul></li></ul></li></ol><h4 id="的用处" tabindex="-1"><a class="header-anchor" href="#的用处" aria-hidden="true">#</a> $的用处</h4><blockquote><p>\${} :可以<strong>替换表名或者列名</strong>， 能确定数据是安全的。可以使用$</p><p>比如说有两条sql语句，一条是根据姓名进行模糊查询，一条是根据地址进行模糊查询，实际上两条的区别也就在查的列以及模糊的那个参数不同，其它都一样</p><ul><li>如果在列名的地方用的是 #{} 的话，就会出现列名这个字符串传进占位符的时候带上引号了，会导致sql语法错误，所以列名要用<code>\${}</code>来占位</li><li>在模糊查询的地方可以用[连接函数](# 第三种方式：通过连接函数)带上<code>#{}</code>来占位</li></ul></blockquote><h4 id="和-区别" tabindex="-1"><a class="header-anchor" href="#和-区别" aria-hidden="true">#</a> #{} 和 \${}区别</h4><ul><li><p>#{}</p><ol><li>#使用 ？在sql语句中做占位的， 使用<strong>PreparedStatement执行sql</strong>，效率高</li><li>#能够避免sql注入，更安全。</li></ol></li><li><p>\${} 3. $不使用占位符，是字符串连接方式，使用<strong>Statement对象执行sql</strong>，效率低 3. $有sql注入的风险，缺乏安全性。 3. <code>$:可以替换表名或者列名</code>（$的唯一的关键用处）</p></li></ul><h3 id="sql返回值" tabindex="-1"><a class="header-anchor" href="#sql返回值" aria-hidden="true">#</a> SQL返回值</h3><h4 id="别名" tabindex="-1"><a class="header-anchor" href="#别名" aria-hidden="true">#</a> 别名</h4><blockquote><p>如果在两个包里有同名的类的话，都用包扫描的别名的话就会报错</p><p>使用全限定名虽然麻烦但是很精确</p></blockquote><p>在主配置文件中定义别名</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--定义别名--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--
        第一种方式：
        可以指定一个类型一个自定义别名
        type:自定义类型的全限定名称
        alias:别名（短小，容易记忆的）
    --&gt;</span>
    <span class="token comment">&lt;!--&lt;typeAlias type=&quot;com.xiaohuowa.domain.Student&quot; alias=&quot;stu&quot; /&gt;--&gt;</span>

    <span class="token comment">&lt;!--
      第二种方式
      &lt;package&gt; name是包名， 这个包中的所有类，类名就是别名（类名不区分大小写）
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaohuowa.domain<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>resultType</code>内直接用别名或者全限定名即可</p><h4 id="返回值是个map" tabindex="-1"><a class="header-anchor" href="#返回值是个map" aria-hidden="true">#</a> 返回值是个Map</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    返回<span class="token class-name">Map</span>
    <span class="token number">1</span>）列名是map的key， 列值是map的value
    <span class="token number">2</span><span class="token punctuation">)</span>只能最多返回一行记录。多余一行是错误
<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;selectMapById&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;java.util.HashMap&quot;</span><span class="token operator">&gt;</span>
    select id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>email from student where id<span class="token operator">=</span>#<span class="token punctuation">{</span>stuid<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="扩展-返回值是单行的map" tabindex="-1"><a class="header-anchor" href="#扩展-返回值是单行的map" aria-hidden="true">#</a> 扩展：返回值是单行的Map</h5><blockquote><p>通过<code>xxxMapper.getReturnMap</code>获取一行map，其中<strong>key为列名或者列别名</strong></p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Tes</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturnMapOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> uMapper<span class="token punctuation">.</span><span class="token function">getReturnMap</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getReturnMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select username nam,address a
    from users
    where id=#{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="扩展-返回值是多行的map" tabindex="-1"><a class="header-anchor" href="#扩展-返回值是多行的map" aria-hidden="true">#</a> 扩展：返回值是多行的Map</h5><blockquote><p>通过<code>xxxMapper.getMulMap</code>获取包含多个map（每行在一个map里）的list</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturnMapMul</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> uMapper<span class="token punctuation">.</span><span class="token function">getMulMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>map <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getMulMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select username,address
    from users
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="模糊查询" tabindex="-1"><a class="header-anchor" href="#模糊查询" aria-hidden="true">#</a> 模糊查询</h4><h5 id="第一种方式-通过java代码中先拼接好模糊查询内容-推荐" tabindex="-1"><a class="header-anchor" href="#第一种方式-通过java代码中先拼接好模糊查询内容-推荐" aria-hidden="true">#</a> 第一种方式：通过Java代码中先拼接好模糊查询内容（推荐）</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;selectLikeOne&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.小火娃.domain.Student&quot;</span><span class="token operator">&gt;</span>
    select <span class="token operator">*</span> from student where name like #<span class="token punctuation">{</span>name<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="第二种方式-在sql语句中拼接" tabindex="-1"><a class="header-anchor" href="#第二种方式-在sql语句中拼接" aria-hidden="true">#</a> 第二种方式：在SQL语句中拼接</h5><blockquote><p>注意：</p><p>在<code>#{name}</code>和左右<code>%</code>之间的<strong>一个空格必须要！</strong></p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;selectLikeTwo&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.xiaohuowa.domain.Student&quot;</span><span class="token operator">&gt;</span>
    select <span class="token operator">*</span> from student where name  like <span class="token string">&quot;%&quot;</span> #<span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token string">&quot;%&quot;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="第三种方式-通过连接函数" tabindex="-1"><a class="header-anchor" href="#第三种方式-通过连接函数" aria-hidden="true">#</a> 第三种方式：通过连接函数</h5><blockquote><p>这里<code>\${col}</code>是一个列名，一定要用$进行占位，才能不带引号传进去</p><p><code>#{colValue}</code>用#可以防止sql注入</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;selectLikeTwo&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.xiaohuowa.domain.Student&quot;</span><span class="token operator">&gt;</span>
    select <span class="token operator">*</span> from student where $<span class="token punctuation">{</span>col<span class="token punctuation">}</span> like <span class="token function">concat</span><span class="token punctuation">(</span><span class="token char">&#39;%&#39;</span><span class="token punctuation">,</span> #<span class="token punctuation">{</span>colValue<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token char">&#39;%&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查询列名和实体类属性名不一致" tabindex="-1"><a class="header-anchor" href="#查询列名和实体类属性名不一致" aria-hidden="true">#</a> 查询列名和实体类属性名不一致</h4><h5 id="解决方法1-列名取别名" tabindex="-1"><a class="header-anchor" href="#解决方法1-列名取别名" aria-hidden="true">#</a> 解决方法1：列名取别名</h5><blockquote><p>将列名取别名为实体属性名</p></blockquote><h5 id="解决方法2-resultmap" tabindex="-1"><a class="header-anchor" href="#解决方法2-resultmap" aria-hidden="true">#</a> 解决方法2：resultMap</h5><p><code>&lt;resultMap&gt;</code></p><ol><li>id <ul><li>id是唯一的</li></ul></li><li>type <ul><li>指定一个返回值类型</li></ul></li><li><code>&lt;id&gt;</code>用于主键绑定 <ul><li>property是实体类属性</li><li>column是查询出来的==表的列名或者别名==</li></ul></li><li><code>&lt;result&gt;</code>用于非主键绑定 <ul><li>property是实体类属性</li><li>column是查询出来的==表的列名或者别名==</li></ul></li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--
	使用resultMap手工完成映射
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bookmap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>book<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--主键绑定--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bookid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--非主键绑定--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bookname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bookmap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select bookid,bookname
    from book
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="返回主键" tabindex="-1"><a class="header-anchor" href="#返回主键" aria-hidden="true">#</a> 返回主键</h3><h4 id="通过-selectkey-标签获取主键" tabindex="-1"><a class="header-anchor" href="#通过-selectkey-标签获取主键" aria-hidden="true">#</a> 通过<code>&lt;selectKey&gt;</code>标签获取主键</h4><p>在插入语句结束后,，返回自增的主键值到入参的users对象的id属性中.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">&quot;insert&quot;</span> parameterType<span class="token operator">=</span><span class="token string">&quot;users&quot;</span> <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>selectKey  keyProperty<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> order<span class="token operator">=</span><span class="token string">&quot;AFTER&quot;</span><span class="token operator">&gt;</span>
    	select <span class="token function">last_insert_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>selectKey<span class="token operator">&gt;</span>
    insert into users <span class="token punctuation">(</span>username<span class="token punctuation">,</span> birthday<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> address<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span>#<span class="token punctuation">{</span>userName<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{</span>birthday<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{</span>sex<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{</span>address<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&lt;selectKey&gt;</code>标签的参数详解:</p><ol><li><code>keyProperty</code>: users对象的哪个属性来接返回的主键值 <ul><li>指定POJO类（对象）的哪个属性来接收主键返回值</li></ul></li><li><code>resultType</code>:返回的主键的类型</li><li><code>order</code>:在插入语句执行前,还是执行后返回主键的值 <ul><li>BEFORE：如果为BEFORE，那么就会先执行selectKey元素中的配置来设置主键，然后再执行插入语句</li><li>AFTER：如果为AFTER，那么会先执行插入语句，再执行selectKey元素中的配置来设置主键</li></ul></li></ol><h3 id="动态sql" tabindex="-1"><a class="header-anchor" href="#动态sql" aria-hidden="true">#</a> 动态SQL</h3><blockquote><p>动态sql: sql的内容是变化的，可以根据条件获取到不同的sql语句。（主要是where部分发生变化。）</p></blockquote><p>动态sql的实现：使用的是mybatis提供的标签， <code>&lt;if&gt; ,&lt;where&gt;,&lt;foreach&gt;</code></p><h4 id="if" tabindex="-1"><a class="header-anchor" href="#if" aria-hidden="true">#</a> <code>&lt;if&gt; </code></h4><p>用来判断条件的，test里写判断</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;判断java对象的属性值&quot;</span><span class="token operator">&gt;</span>
	部分sql语句
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="where" tabindex="-1"><a class="header-anchor" href="#where" aria-hidden="true">#</a> <code>&lt;where&gt;</code></h4><p>用来包含 多个<code>&lt;if&gt;</code>的， 当多个if有一个成立的， <code>&lt;where&gt;</code>会<strong>自动增加一个where</strong>关键字，并<strong>去掉 if中多余的 and ，or</strong>等。</p><h4 id="set" tabindex="-1"><a class="header-anchor" href="#set" aria-hidden="true">#</a> <code>&lt;set&gt;</code></h4><blockquote><p>有选择的进行更新处理，至少更新一列</p><p>能够保证如果没有传值进来，则数据库中的数据保持不变</p><p>==会自动去掉多余的逗号==</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">&quot;updateBySet&quot;</span> parameterType<span class="token operator">=</span><span class="token string">&quot;users&quot;</span><span class="token operator">&gt;</span>
    update users
    <span class="token generics"><span class="token punctuation">&lt;</span>set<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;userName != null and userName != &#39;&#39;&quot;</span><span class="token operator">&gt;</span>
            username <span class="token operator">=</span> #<span class="token punctuation">{</span>userName<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;birthday != null&quot;</span><span class="token operator">&gt;</span>
            birthday <span class="token operator">=</span> #<span class="token punctuation">{</span>birthday<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;sex != null and sex != &#39;&#39;&quot;</span><span class="token operator">&gt;</span>
            sex <span class="token operator">=</span> #<span class="token punctuation">{</span>sex<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;address != null and address != &#39;&#39;&quot;</span><span class="token operator">&gt;</span>
            address <span class="token operator">=</span>#<span class="token punctuation">{</span>address<span class="token punctuation">}</span> <span class="token punctuation">,</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>set<span class="token operator">&gt;</span>
    where id <span class="token operator">=</span> #<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="foreach" tabindex="-1"><a class="header-anchor" href="#foreach" aria-hidden="true">#</a> <code>&lt;foreach&gt;</code></h4><p><code>&lt;foreach&gt;</code> 循<code>环java中的数</code>组，list集合的。 主要用在sql的in语句中。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>foreach collection<span class="token operator">=</span><span class="token string">&quot;&quot;</span> item<span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token keyword">open</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span> close<span class="token operator">=</span><span class="token string">&quot;&quot;</span> separator<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>
	#<span class="token punctuation">{</span>xxx<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>foreach<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p><code>collection</code>:表示接口中的方法参数的类型</p><ul><li>如果是数组使用array , 如果是list集合使用list，如果是Map集合用map</li></ul></li><li><p><code>item</code>:自定义的，表示数组和集合成员的变量</p></li><li><p><code>open</code>:循环开始是的字符</p></li><li><p><code>close</code>:循环结束时的字符</p></li><li><p><code>separator</code>:集合成员之间的分隔符</p></li></ol><h5 id="批量添加" tabindex="-1"><a class="header-anchor" href="#批量添加" aria-hidden="true">#</a> 批量添加</h5><blockquote><p>批量的点在插入的values之后n个数据逗号分隔</p><p>==这个操作属于一次执行多条SQL语句，需要在连接JDBC的url后面加上这个**&amp;allowMultiQueries=true** 来允许多条操作==</p></blockquote><p>用List装所有对象，在SQL语句的values后面用foreach遍历list，将每个对象取出并将数据用 #{} 放好</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">&quot;insertBatch&quot;</span> <span class="token operator">&gt;</span>
    insert into <span class="token function">users</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>birthday<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>address<span class="token punctuation">)</span> values
    <span class="token operator">&lt;</span>foreach collection<span class="token operator">=</span><span class="token string">&quot;list&quot;</span> separator<span class="token operator">=</span><span class="token string">&quot;,&quot;</span> item<span class="token operator">=</span><span class="token string">&quot;u&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">(</span>#<span class="token punctuation">{</span>u<span class="token punctuation">.</span>userName<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{</span>u<span class="token punctuation">.</span>birthday<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{</span>u<span class="token punctuation">.</span>sex<span class="token punctuation">}</span><span class="token punctuation">,</span>#<span class="token punctuation">{</span>u<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>foreach<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="批量更新" tabindex="-1"><a class="header-anchor" href="#批量更新" aria-hidden="true">#</a> 批量更新</h5><blockquote><p>批量的点在批量执行n多条update的语句</p></blockquote><p>用List装所有对象，进入更新语句的时候直接上foreach遍历list（注意这里的结束标签是分号，因为sql语句结束是分号结尾），在foreach里面再套进对象的update语句（可以用set+if标签增强健壮性）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">&quot;updateSet&quot;</span>  <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>foreach collection<span class="token operator">=</span><span class="token string">&quot;list&quot;</span> item<span class="token operator">=</span><span class="token string">&quot;u&quot;</span> separator<span class="token operator">=</span><span class="token string">&quot;;&quot;</span><span class="token operator">&gt;</span>
        update users
        <span class="token generics"><span class="token punctuation">&lt;</span>set<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;u.userName != null  and u.userName != &#39;&#39;&quot;</span><span class="token operator">&gt;</span>
            username<span class="token operator">=</span>#<span class="token punctuation">{</span>u<span class="token punctuation">.</span>userName<span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;u.birthday != null&quot;</span><span class="token operator">&gt;</span>
            birthday <span class="token operator">=</span> #<span class="token punctuation">{</span>u<span class="token punctuation">.</span>birthday<span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;u.sex != null  and u.sex != &#39;&#39;&quot;</span><span class="token operator">&gt;</span>
            sex <span class="token operator">=</span> #<span class="token punctuation">{</span>u<span class="token punctuation">.</span>sex<span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">&quot;u.address != null  and u.address != &#39;&#39;&quot;</span><span class="token operator">&gt;</span>
            address <span class="token operator">=</span> #<span class="token punctuation">{</span>u<span class="token punctuation">.</span>address<span class="token punctuation">}</span>
    	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>set<span class="token operator">&gt;</span>
        where id <span class="token operator">=</span> #<span class="token punctuation">{</span>u<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>foreach<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="sql代码片段" tabindex="-1"><a class="header-anchor" href="#sql代码片段" aria-hidden="true">#</a> sql代码片段</h4><blockquote><p>可以复用实现SQL代码复用</p></blockquote><p>使用步骤</p><ol><li>先定义 <code>&lt;sql id=&quot;自定义名称唯一&quot;&gt; sql语句， 表名，字段等 &lt;/sql&gt;</code></li><li>再通过 <code>&lt;include refid=&quot;id的值&quot; /&gt;</code>把定义的sql语句插入</li></ol><h3 id="主配置文件" tabindex="-1"><a class="header-anchor" href="#主配置文件" aria-hidden="true">#</a> 主配置文件</h3><h4 id="设置日志开启" tabindex="-1"><a class="header-anchor" href="#设置日志开启" aria-hidden="true">#</a> 设置日志开启</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--设置日志输出底层执行的代码--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logImpl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT_LOGGING<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="environment" tabindex="-1"><a class="header-anchor" href="#environment" aria-hidden="true">#</a> <code>&lt;environment&gt;</code></h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mydev<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--
      transactionManager:mybatis提交事务，回顾事务的方式
         type: 事务的处理的类型
             1）JDBC :（将事务控制交给程序员）表示mybatis底层是调用JDBC中的Connection对象的，commit， rollback
             2）MANAGED : （将事务控制交给容器）把mybatis的事务处理委托给其它的容器（一个服务器软件，一个框架（spring））
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--
       dataSource:表示数据源，java体系中，规定实现了javax.sql.DataSource接口的都是数据源。
                  数据源表示Connection对象的。

       type:指定数据源的类型
          1）POOLED: 使用连接池， mybatis会创建PooledDataSource类
          2）UPOOLED: 不使用连接池， 在每次执行sql语句，先创建连接，执行sql，在关闭连接
                      mybatis会创建一个UnPooledDataSource，管理Connection对象的使用
          3）JNDI：java命名和目录服务（windows注册表）
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--数据库的驱动类名--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${jdbc.driver}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--连接数据库的url字符串--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${jdbc.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--访问数据库的用户名--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${jdbc.user}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--密码--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${jdbc.passwd}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="properties" tabindex="-1"><a class="header-anchor" href="#properties" aria-hidden="true">#</a> <code>&lt;properties&gt;</code></h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--指定properties文件的位置，从类路径根开始找文件--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc.properties<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用的时候直接用<code>\${在properties里的key}</code>即可</p></blockquote><h4 id="mappers" tabindex="-1"><a class="header-anchor" href="#mappers" aria-hidden="true">#</a> <code>&lt;mappers&gt;</code></h4><p>四种方式（优先级从上到下依次递减）</p><ol><li>package</li><li>resource</li><li>url</li><li>class</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- sql mapper(sql映射文件)的位置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--第一种方式：指定多个mapper文件--&gt;</span>
    <span class="token comment">&lt;!--&lt;mapper resource=&quot;com/bjpowernode/dao/StudentDao.xml&quot;/&gt;
    &lt;mapper resource=&quot;com/bjpowernode/dao/OrderDao.xml&quot; /&gt;--&gt;</span>

    <span class="token comment">&lt;!--第二种方式： 使用包名
        name: xml文件（mapper文件）所在的包名, 这个包中所有xml文件一次都能加载给mybatis
        使用package的要求：
         1. mapper文件名称需要和接口名称一样， 区分大小写的一样
         2. mapper文件和dao接口需要在同一目录
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.bjpowernode.dao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token comment">&lt;!-- &lt;package name=&quot;com.bjpowernode.dao2&quot;/&gt;
    &lt;package name=&quot;com.bjpowernode.dao3&quot;/&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="优先级源码" tabindex="-1"><a class="header-anchor" href="#优先级源码" aria-hidden="true">#</a> 优先级源码</h5><p>优先级PRUC</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">mapperElement</span><span class="token punctuation">(</span><span class="token class-name">XNode</span> parent<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Iterator</span> var2 <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>var2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">XNode</span> child <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">XNode</span><span class="token punctuation">)</span>var2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> resource<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;package&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 1.先进行package判断</span>
                    resource <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">.</span><span class="token function">addMappers</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    resource <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> url <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> mapperClass <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getStringAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">XMLMapperBuilder</span> mapperParser<span class="token punctuation">;</span>
                    <span class="token class-name">InputStream</span> inputStream<span class="token punctuation">;</span>
                    <span class="token comment">// 2.判断resource</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> url <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mapperClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mapperParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLMapperBuilder</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">,</span> resource<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">.</span><span class="token function">getSqlFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mapperParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 3.判断url</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> url <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mapperClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">ErrorContext</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getUrlAsStream</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mapperParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLMapperBuilder</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">.</span><span class="token function">getSqlFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mapperParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// 4.判断class </span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> url <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> mapperClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BuilderException</span><span class="token punctuation">(</span><span class="token string">&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> mapperInterface <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">classForName</span><span class="token punctuation">(</span>mapperClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>configuration<span class="token punctuation">.</span><span class="token function">addMapper</span><span class="token punctuation">(</span>mapperInterface<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="表与表关系" tabindex="-1"><a class="header-anchor" href="#表与表关系" aria-hidden="true">#</a> 表与表关系</h3><blockquote><p>一对一配置：<code>&lt;resultMap&gt; [+ &lt;association&gt;]</code></p><p>一对多配置：<code>&lt;resultMap&gt; + &lt;collection&gt;</code></p><p>多对多配置：<code>&lt;resultMap&gt; + &lt;collection&gt;</code></p><p><em><strong>*无论是什么关联关系，如果某方持有另一方的集合，则使用<code>&lt;collection&gt;</code>标签完成映射，如果某方持有另一方的对象，则使用<code>&lt;association&gt;</code>标签完成映射。*</strong></em></p></blockquote><h4 id="一对一" tabindex="-1"><a class="header-anchor" href="#一对一" aria-hidden="true">#</a> 一对一</h4><p>[用法同多对一](# 多对一)</p><h4 id="一对多" tabindex="-1"><a class="header-anchor" href="#一对多" aria-hidden="true">#</a> 一对多</h4><blockquote><p>一个客户对应多个订单</p><p>需要通过客户id查到客户，以及与之相关的订单</p></blockquote><p>查询步骤：</p><ol><li>在pojo类的一方中加入<code>List&lt;多方&gt;</code>属性</li><li>在左外连接查询之后用[<code>resultMap</code>](# 解决方法2：resultMap)进行映射</li><li>写到<code>List&lt;多方&gt;</code>属性的映射时使用<code>&lt;collection&gt;</code>元素来处理一对多关联关系 <ul><li><code>&lt;collection&gt;</code>中<code>property属性</code>表示在实体类中<code>List&lt;多方&gt;</code>属性的属性名</li><li><code>&lt;collection&gt;</code>中<code>ofType属性</code>表示返回值的类型（也就是多方的全限定名 / 别名）</li></ul></li></ol><p>==注意一个坑：如果用内联查询（inner join）的话，客户没有订单就会导致查完是null。改成左外连接（left join）就可以查出客户信息，没订单就订单部分为null==</p><p>（left join是左外连接，从表没数据也会保留主表，写在left join左边的是主表，右边的是从表）</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>- left join语法

select xx,yy,zz
from A表 left join B表
on a.id = b.id
where a.id = 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实例：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.小火娃.mapper.CustomerMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!--
     //根据客户的id查询客户所有信息并同时查询该客户名下的所有订单
    Customer getById(Integer id)

    实体类:
    //customer表中的三个列
        private Integer id;
        private String name;
        private Integer age;

    //该客户名下的所有订单的集合
    private List&lt;Orders&gt; ordersList;
   --&gt;</span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customermap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--主键绑定--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--非主键绑定--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--多出来的列绑定ordersList
        Orders实体类:
            private Integer id;
            private String orderNumber;
            private Double orderPrice;
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ordersList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--主键绑定--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>oid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--非主键绑定--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orderNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orderNumber<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orderPrice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orderPrice<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customermap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select c.id cid,name,age,o.id oid,orderNumber,orderPrice,customer_id
        from customer c left  join orders o on c.id = o.customer_id
        where c.id=#{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多对一" tabindex="-1"><a class="header-anchor" href="#多对一" aria-hidden="true">#</a> 多对一</h4><blockquote><p>一个客户对应多个订单</p><p>需要通过订单id查到订单信息，以及与之关联的客户信息（多对一）</p></blockquote><p>查询步骤：</p><ol><li>在pojo类的多方（订单）中加入<code>”客户方“</code>的属性</li><li>在内联查询之后用[<code>resultMap</code>](# 解决方法2：resultMap)进行映射</li><li>写到<code>”客户方“</code>属性的映射时使用<code>&lt;association&gt;</code>元素来处理一对一关联关系 <ul><li><code>&lt;association&gt;</code>中<code>property属性</code>表示在实体类中<code>”客户方“</code>属性的属性名</li><li><code>&lt;association&gt;</code>中<code>javaType属性</code>表示返回值的类型（也就是“客户方”的全限定名 / 别名）</li></ul></li></ol><h4 id="多对多" tabindex="-1"><a class="header-anchor" href="#多对多" aria-hidden="true">#</a> 多对多</h4><p>实际上也是把多对多拆成一对多来写了</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.oracle.demo.mapper.BookMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span> bookmap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>book<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bid <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span> bname <span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>bname <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--关联属性--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>categoryList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span> cid <span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span> cid <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span> cname <span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cname <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bookmap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        select *
        from book b inner join middle m on b.bid = m.m_bid 
        inner join category c on m.m_cid = c.cid
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="优化方案-嵌套查询" tabindex="-1"><a class="header-anchor" href="#优化方案-嵌套查询" aria-hidden="true">#</a> 优化方案：嵌套查询</h4><blockquote><p>SQL语句分开，查订单的归类到订单mapper里，查客户的归类到客户mapper里</p></blockquote><p>通过在查主表的时候association或者collection里面加上column和select完成</p><ol><li>column <ul><li>指定刚才sql查出来的哪个字段要给下面select传进去</li></ul></li><li>select <ul><li>指定一个<code>namespace.id</code>的mapper里的sql语句，将上面column的值当入参传进去</li></ul></li></ol><h3 id="缓存" tabindex="-1"><a class="header-anchor" href="#缓存" aria-hidden="true">#</a> 缓存</h3><p><img src="https://s2.loli.net/2023/10/17/LXe8mtwFJc1Vn9Y.png" alt="image-20220905194845830"></p><ol><li><code> 一级缓存</code>使用的是<code>SqlSession的作用域</code>，同一个sqlSession共享一级缓存的数据</li><li><code>二级缓存</code>使用的是<code>mapper的作用域</code>，不同的sqlSession只要访问的同一个mapper.xml文件,则共享二级缓存作用域</li></ol><p>缓存为了提高查询效率</p><h4 id="缓存访问过程" tabindex="-1"><a class="header-anchor" href="#缓存访问过程" aria-hidden="true">#</a> 缓存访问过程</h4><ol><li>执行查询语句，先到缓存找有没有</li><li>缓存有就直接返回，缓存没有再去数据库找</li><li>去数据库查到之后先给缓存里存一份，再返回</li><li>之后只要没有增删改的操作就可以一直用这个缓存，如果有<strong>增删改（commit操作）的话会清空所有缓存</strong></li></ol><h4 id="缓存的开启" tabindex="-1"><a class="header-anchor" href="#缓存的开启" aria-hidden="true">#</a> 缓存的开启</h4><h5 id="一级缓存" tabindex="-1"><a class="header-anchor" href="#一级缓存" aria-hidden="true">#</a> 一级缓存</h5><p>一级缓存默认开启</p><h5 id="二级缓存" tabindex="-1"><a class="header-anchor" href="#二级缓存" aria-hidden="true">#</a> 二级缓存</h5><ol><li><p>在Mybatis配置文件中加入配置</p><ul><li><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--设置日志输出底层执行的代码--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logImpl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT_LOGGING<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 开启二级缓存 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cacheEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>在需要开启缓存的XxxxMapper.xml文件里加入标签</p><ul><li><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.小火娃.mapper.XxxxMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>对应实体类实现<code>java.io.serializable接口</code>，保证实体可序列化</p><ul><li><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pojo</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ol><p>这样就可以在同个mapper域中共用二级缓存</p><h3 id="pagehelper" tabindex="-1"><a class="header-anchor" href="#pagehelper" aria-hidden="true">#</a> PageHelper</h3><p>用来做数据分页（可以自动在sql后面加上<code>limit x, y</code>）</p><h4 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法" aria-hidden="true">#</a> 使用方法</h4><p>一、加入依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--PageHelper依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>二、在主配置文件中配置插件</p><p>（在<code>&lt;environments&gt;</code>标签上面）</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--配置插件--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">interceptor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.github.pagehelper.PageInterceptor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>三、在查询操作之前加入PageHelper方法的调用</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectAllPageHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MyBatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StudentDao</span> dao  <span class="token operator">=</span>  sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//加入PageHelper的方法，分页</span>
    <span class="token comment">// pageNum: 第几页， 从1开始</span>
    <span class="token comment">// pageSize: 一页中有多少行数据</span>
    <span class="token class-name">PageHelper</span><span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token operator">:</span>students<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;foreach--one ===&quot;</span><span class="token operator">+</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="拓展" tabindex="-1"><a class="header-anchor" href="#拓展" aria-hidden="true">#</a> 拓展</h2><h3 id="uuid" tabindex="-1"><a class="header-anchor" href="#uuid" aria-hidden="true">#</a> UUID</h3><p>这是一个全球唯一随机字符串，由<strong>36个字母数字中划线组成</strong></p><p><code>UUID uuid = UUID.randomUUID();</code></p><p><code>System.out.println(uuid.toString().replace(&quot;-&quot;,&quot;&quot;).substring(20));</code>将里面的“-”去掉并截取12位，通过截取后再拼接其他数据（用户id或者时间戳等等）就可以实现获取一个唯一的主键了</p><blockquote><p>Mysql里也可以获取UUID</p><p><code>select UUID();</code></p></blockquote><h3 id="快捷键" tabindex="-1"><a class="header-anchor" href="#快捷键" aria-hidden="true">#</a> 快捷键</h3><h4 id="查看接口实现类" tabindex="-1"><a class="header-anchor" href="#查看接口实现类" aria-hidden="true">#</a> 查看接口实现类</h4><p>光标放在接口名上<code>Ctrl + h</code>可以查看接口实现类</p><h4 id="查看类中所有成员-方法" tabindex="-1"><a class="header-anchor" href="#查看类中所有成员-方法" aria-hidden="true">#</a> 查看类中所有成员，方法</h4><p><code>alt</code></p><h3 id="mybatis工具类" tabindex="-1"><a class="header-anchor" href="#mybatis工具类" aria-hidden="true">#</a> Mybatis工具类</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisUtils</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span>  <span class="token keyword">static</span>  <span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> config<span class="token operator">=</span><span class="token string">&quot;mybatis.xml&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 需要和你的项目中的文件名一样</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//创建SqlSessionFactory对象，使用SqlSessionFactoryBuild</span>
            factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//获取SqlSession的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSession</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SqlSession</span> sqlSession  <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> factory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            sqlSession <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 非自动提交事务</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sqlSession<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据库存date" tabindex="-1"><a class="header-anchor" href="#数据库存date" aria-hidden="true">#</a> 数据库存DATE</h3><p>数据库存的时候是DATE类型，在执行DAO插入的时候，要插入一个对应日期，就要用到日期格式刷</p><blockquote><p>日期的格式化刷子 <code>SimpleDateFormat sf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</code></p><p>在测试对象的时候通过<code>sf.parse</code>可以返回一个Date对象</p><p><code>Users u = new Users(1,&quot;name&quot;,sf.parse(&quot;2000-01-01&quot;));</code></p></blockquote><h3 id="orm" tabindex="-1"><a class="header-anchor" href="#orm" aria-hidden="true">#</a> ORM</h3><h4 id="是什么" tabindex="-1"><a class="header-anchor" href="#是什么" aria-hidden="true">#</a> 是什么</h4><p><code>ORM(Object Relational Mapping)</code>:对象关系映射</p><p>MyBatis框架是ORM非常优秀的框架</p><p>java语言中以对象的方式操作数据，存到数据库中是以表的方式进行存储，对象中的成员变量与表中的列之间的数据互换称为映射，整个这套操作就是ORM.</p><h4 id="orm操作也可以称为是持久化操作" tabindex="-1"><a class="header-anchor" href="#orm操作也可以称为是持久化操作" aria-hidden="true">#</a> ORM操作也可以称为是持久化操作</h4><blockquote><p>从数据库到对象，从对象到数据库。这种双向的操作都是持久化操作</p></blockquote><p>持久化的操作：将对象保存到关系型数据库中，将关系型数据库中的数据读取出来以对象的形式封装</p><p>MyBatis是持久化层优秀的框架</p><h3 id="pom添加资源文件的指定" tabindex="-1"><a class="header-anchor" href="#pom添加资源文件的指定" aria-hidden="true">#</a> POM添加资源文件的指定</h3><blockquote><p>如果mapper是放在java目录下的话，默认编译的时候是不会拷贝java目录下<code>.xml</code>文件的，所以要加入以下标签，让java目录下的资源文件也会在编译的时候被拷贝进<code>classes</code>目录</p><ul><li>为什么下面标签不仅指定了java目录，而且还指定了resources目录？</li><li>因为如果只指定了一个，另一个就不会拷贝了，所以保险起见都指定上</li></ul></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--添加资源文件的指定--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mybatis动态代理的规范" tabindex="-1"><a class="header-anchor" href="#mybatis动态代理的规范" aria-hidden="true">#</a> mybatis动态代理的规范</h3><ol><li>UsersMapper.xml文件与UsersMapper.java的接口必须<strong>同一个目录下</strong></li><li>UsersMapper.xml文件与UsersMapper.java的接口的<strong>文件名必须一致</strong>（后缀不管）</li><li>UserMapper.xml文件中标签的<strong>id值</strong>与与UserMapper.java的接口中<strong>方法的名称完全一致</strong></li><li>UserMapper.xml文件中标签的parameterType属性值与与UserMapper.java的接口中方法的<strong>参数类型完全一致</strong></li><li>UserMapper.xml文件中标签的resultType值与与UserMapper.java的接口中方法的<strong>返回值类型完全一致</strong></li><li>UserMapper.xml文件中namespace属性必须是接口的<strong>完全限定名称</strong></li><li>在SqlMapConfig.xml文件中注册mapper文件时,使用<code>class=</code>接口的<strong>完全限定名称</strong></li></ol>`,194),o=[p];function l(c,i){return s(),a("div",null,o)}const r=n(e,[["render",l],["__file","MyNote_Mybatis.html.vue"]]);export{r as default};
